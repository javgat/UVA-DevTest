swagger: '2.0'
info:
  description: DevTest
  version: 1.0.0
  title: DevTest
  # put the contact info for your development or API team
  contact:
    email: javigaton@gmail.com

  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html

# tags are used for organizing operations
tags:
- name: user
  description: Operations related to users
- name: auth
  description: Operations related to authentication
- name: team
  description: Operations related to teams
paths:
  /accesstokens:
    post:
      tags:
      - auth
      summary: Registers a new authorized connection token
      operationId: Login
      description: Tries to login, and gets a JWT auth token if successful
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: loginUser
        description: User who is trying to generate a token
        required: true
        schema:
          $ref: '#/definitions/LoginUser'
      responses:
        200:
          description: Successful authentication. Session JWT returned in Cookie "Bearer-Cookie". You need to include this cookie in subsequent requests.
          headers:
            Set-Cookie:
              type: string
              #example: Bearer-Cookie=eyJhbGciOiJIUzI1NiIsInR5; Path=/; Max-Age=86400; Secure; SameSite=Strict; HttpOnly;
        400:
          $ref: '#/responses/BadRequestError'
        410:
          $ref: '#/responses/GoneError'
        500:
          $ref: '#/responses/InternalServerError'
  /users:
    post:
      tags:
      - user
      - auth
      summary: adds a user
      operationId: RegisterUser
      description: Adds a user to the system
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: signinUser
        description: User item to add
        required: true
        schema:
          $ref: '#/definitions/SigninUser'
      responses:
        201:
          description: user created
          schema:
            $ref: '#/definitions/User'
        400:
          $ref: '#/responses/BadRequestError'
        409:
          $ref: '#/responses/ConflictError'
        500:
          $ref: '#/responses/InternalServerError'
    get:
      security:
        - BearerCookie: []
      tags:
      - user
      summary: Returns all users. Only for admins
      operationId: GetUsers
      description: Returns all users. Only for admins
      produces:
      - application/json
      responses:
        200:
          description: users found
          schema:
            type: array
            items:
              $ref: '#/definitions/User'
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        500:
          $ref: '#/responses/InternalServerError'
  /users/{username}:
    get:
      security:
        - BearerCookie: []
      tags:
      - user
      summary: Finds a user by its username
      operationId: getUser
      description: Finds a user by its username
      produces:
      - application/json
      parameters:
      - in: path
        name: username
        description: Username of the user to find
        required: true
        type: string
      responses:
        200:
          description: user found
          schema:
            $ref: '#/definitions/User'
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        410:
          $ref: '#/responses/GoneError'
        500:
          $ref: '#/responses/InternalServerError'
    put:
      security:
        - BearerCookie: []
      tags:
      - user
      summary: Modifies the user <username>
      operationId: putUser
      description: Modifies the user <username>
      consumes:
      - application/json
      parameters:
      - in: path
        name: username
        description: Username of the user to modify its information
        required: true
        type: string
      - in: body
        name: user
        required: true
        description: User information updated
        schema:
          $ref: '#/definitions/User'
      responses:
        200:
          description: user updated
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        409:
          $ref: '#/responses/ConflictError'
        410:
          $ref: '#/responses/GoneError'
        500:
          $ref: '#/responses/InternalServerError'
    delete:
      security:
        - BearerCookie: []
      tags:
      - user
      summary: Deletes a user by its username
      operationId: deleteUser
      description: Deletes a user by its username
      parameters:
      - in: path
        name: username
        description: Username of the user to delete
        required: true
        type: string
      responses:
        200:
          description: user found and deleted
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        410:
          $ref: '#/responses/GoneError'
        500:
          $ref: '#/responses/InternalServerError'
  /passwords/{username}:
    put:
      security:
        - BearerCookie: []
      tags:
      - user
      - auth
      summary: Modifies the password of the user <username>
      operationId: putPassword
      description: Modifies the password of the user <username>
      consumes:
      - application/json
      parameters:
      - in: path
        name: username
        description: Username of the user to modify its password
        required: true
        type: string
      - in: body
        name: passwordUpdate
        description: Password update information
        required: true
        schema:
          $ref: '#/definitions/PasswordUpdate'
      responses:
        200:
          description: Resource password modified correctly
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        410:
          $ref: '#/responses/GoneError'
        500:
          $ref: '#/responses/InternalServerError'
  /users/{username}/teams:
    get:
      security:
        - BearerCookie: []
      tags:
      - user
      - team
      summary: Returns all teams of a user.
      operationId: GetTeamsOfUser
      description: Returns all teams of a user.
      produces:
      - application/json
      parameters:
      - in: path
        name: username
        description: Username of the user to get their teams
        required: true
        type: string
      responses:
        200:
          description: teams found
          schema:
            type: array
            items:
              $ref: '#/definitions/Team'
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        500:
          $ref: '#/responses/InternalServerError'
  /users/{username}/teams/{teamname}:
    put:
      security:
        - BearerCookie: []
      tags:
      - user
      - team
      summary: Adds user {username} to team {teamname}
      operationId: AddTeamOfUser
      description: Adds user {username} to team {teamname}
      produces:
      - application/json
      parameters:
      - in: path
        name: teamname
        description: Teamname of the team to modify
        required: true
        type: string
      - in: path
        name: username
        description: Username of the user to add
        required: true
        type: string
      responses:
        200:
          description: User added to team
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        409:
          $ref: '#/responses/ConflictError' #? lo quito? si ya esta a√±adido deberia devolver error?
        410:
          $ref: '#/responses/GoneError'
        500:
          $ref: '#/responses/InternalServerError'
    delete:
      security:
        - BearerCookie: []
      tags:
      - user
      - team
      summary: Deletes user {username} from team {teamname}
      operationId: DeleteTeamOfUser
      description: Deletes user {username} from team {teamname}
      produces:
      - application/json
      parameters:
      - in: path
        name: teamname
        description: Teamname of the team to modify
        required: true
        type: string
      - in: path
        name: username
        description: Username of the user to delete from team
        required: true
        type: string
      responses:
        200:
          description: User deleted from team
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        410:
          $ref: '#/responses/GoneError'
        500:
          $ref: '#/responses/InternalServerError'
  /users/{username}/teams/{teamname}/role:
    get:
      security:
        - BearerCookie: []
      tags:
      - team
      - user
      summary: Returns the role of a user in a team
      operationId: GetUserTeamRole
      description: Returns the role of a user in a team
      produces:
      - application/json
      parameters:
      - in: path
        name: teamname
        description: Teamname of the team to modify
        required: true
        type: string
      - in: path
        name: username
        description: Username of the user to modify its role
        required: true
        type: string
      responses:
        200:
          description: Role found
          schema:
            $ref: '#/definitions/TeamRole'
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        410:
          $ref: '#/responses/GoneError'
        500:
          $ref: '#/responses/InternalServerError'
    put:
      security:
        - BearerCookie: []
      tags:
      - team
      - user
      summary: Modifies the role of a user in a team
      operationId: PutUserTeamRole
      description: Modifies the role of a user in a team
      consumes:
      - application/json
      parameters:
      - in: body
        name: role
        description: New role of the user
        required: true
        schema:
          $ref: '#/definitions/TeamRole'
      - in: path
        name: teamname
        description: Teamname of the team to modify
        required: true
        type: string
      - in: path
        name: username
        description: Username of the user to modify its role
        required: true
        type: string
      responses:
        200:
          description: Role modified
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        410:
          $ref: '#/responses/GoneError'
        500:
          $ref: '#/responses/InternalServerError'
  /teams:
    post:
      security:
        - BearerCookie: []
      tags:
      - team
      summary: adds a team
      operationId: PostTeam
      description: Adds a team to the system
      consumes:
      - application/json
      produces:
      - application/json
      parameters:
      - in: body
        name: team
        description: Team item to add
        required: true
        schema:
          $ref: '#/definitions/Team'
      responses:
        201:
          description: team created
          schema:
            $ref: '#/definitions/Team'
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        409:
          $ref: '#/responses/ConflictError'
        500:
          $ref: '#/responses/InternalServerError'
    get:
      security:
        - BearerCookie: []
      tags:
      - team
      summary: Returns all teams.
      operationId: GetTeams
      description: Returns all teams.
      produces:
      - application/json
      responses:
        200:
          description: teams found
          schema:
            type: array
            items:
              $ref: '#/definitions/Team'
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        500:
          $ref: '#/responses/InternalServerError'
  /teams/{teamname}:
    get:
      security:
        - BearerCookie: []
      tags:
      - team
      summary: Finds a team by its teamname
      operationId: getTeam
      description: Finds a team by its teamname
      produces:
      - application/json
      parameters:
      - in: path
        name: teamname
        description: Teamname of the team to find
        required: true
        type: string
      responses:
        200:
          description: team found
          schema:
            $ref: '#/definitions/Team'
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        410:
          $ref: '#/responses/GoneError'
        500:
          $ref: '#/responses/InternalServerError'
    put:
      security:
        - BearerCookie: []
      tags:
      - team
      summary: Modifies the team <teamname>
      operationId: putTeam
      description: Modifies the team <teamname>
      consumes:
      - application/json
      parameters:
      - in: path
        name: teamname
        description: Teamname of the team to modify its information
        required: true
        type: string
      - in: body
        name: team
        required: true
        description: Team information updated
        schema:
          $ref: '#/definitions/Team'
      responses:
        200:
          description: team updated
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        409:
          $ref: '#/responses/ConflictError'
        410:
          $ref: '#/responses/GoneError'
        500:
          $ref: '#/responses/InternalServerError'
    delete:
      security:
        - BearerCookie: []
      tags:
      - team
      summary: Deletes a team by its teamname
      operationId: deleteTeam
      description: Deletes a team by its teamname
      parameters:
      - in: path
        name: teamname
        description: Teamname of the team to delete
        required: true
        type: string
      responses:
        200:
          description: team found and deleted
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        410:
          $ref: '#/responses/GoneError'
        500:
          $ref: '#/responses/InternalServerError'
  /teams/{teamname}/users:
    get:
      security:
        - BearerCookie: []
      tags:
      - user
      - team
      summary: Returns all users that are members of a team
      operationId: GetUsersFromTeam
      description: Returns all users that are members of a team
      produces:
      - application/json
      parameters:
      - in: path
        name: teamname
        description: Teamname of the team to get its users
        required: true
        type: string
      responses:
        200:
          description: users found
          schema:
            type: array
            items:
              $ref: '#/definitions/User'
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        500:
          $ref: '#/responses/InternalServerError'
  /teams/{teamname}/users/{username}:
    put:
      security:
        - BearerCookie: []
      tags:
      - user
      - team
      summary: Adds user {username} to team {teamname}
      operationId: AddUserFromTeam
      description: Adds user {username} to team {teamname}
      produces:
      - application/json
      parameters:
      - in: path
        name: teamname
        description: Teamname of the team to modify
        required: true
        type: string
      - in: path
        name: username
        description: Username of the user to add
        required: true
        type: string
      responses:
        200:
          description: User added to team
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        409:
          $ref: '#/responses/ConflictError' #? lo quito? si ya esta a√±adido deberia devolver error?
        410:
          $ref: '#/responses/GoneError'
        500:
          $ref: '#/responses/InternalServerError'
    delete:
      security:
        - BearerCookie: []
      tags:
      - user
      - team
      summary: Deletes user {username} from team {teamname}
      operationId: DeleteUserFromTeam
      description: Deletes user {username} from team {teamname}
      produces:
      - application/json
      parameters:
      - in: path
        name: teamname
        description: Teamname of the team to modify
        required: true
        type: string
      - in: path
        name: username
        description: Username of the user to delete from team
        required: true
        type: string
      responses:
        200:
          description: User deleted from team
        400:
          $ref: '#/responses/BadRequestError'
        403:
          $ref: '#/responses/ForbiddenError'
        410:
          $ref: '#/responses/GoneError'
        500:
          $ref: '#/responses/InternalServerError'
responses:
  BadRequestError:
    description: Incorrect Request, or invalida data
    schema:
      $ref: '#/definitions/Error'
  ForbiddenError:
    description: Not authorized to this content
    schema:
      $ref: '#/definitions/Error'
  ConflictError:
    description: A user with same username/email already exists
    schema:
      $ref: '#/definitions/Error'
  GoneError:
    description: That user (password and name) does not exist
    schema:
      $ref: '#/definitions/Error'
  InternalServerError:
    description: Internal error
definitions:
  SigninUser:
    type: object
    required:
    - username
    - email
    - pass
    properties:
      username:
        type: string
        example: carlosg72
        pattern: '^[^@ \t\r\n]+$'
      email:
        type: string
        example: carlos@mail.com
        format: email
        pattern: '^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$'
      pass:
        type: string
        example: password
        format: password
        pattern: '^.{6,}$'
  LoginUser:
    type: object
    required:
    - loginid
    - pass
    properties:
      loginid:
        type: string
        example: carlosg72 || carlos@mail.com #??????
      pass:
        type: string
        example: password
        format: password
        pattern: '^.{6,}$'
  JWTJson:
    type: object
    required:
    - token
    properties:
      token:
        type: string
        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
  User:
    type: object
    required:
    - username
    - email
    properties:
      username:
        type: string
        example: carlosg72
        pattern: '^[^@ \t\r\n]+$'
      email:
        type: string
        example: carlos@mail.com
        format: email
        pattern: '^[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+$'
      fullname:
        type: string
        example: Javier Gat√≥n Herguedas
      type:
        type: string
        enum: [student, teacher, admin]
  Team:
    type: object
    required:
    - teamname
    properties:
      teamname:
        type: string
        example: devtestTeam
        pattern: '^[^@ \t\r\n]+$'
      description:
        type: string
        example: DevTest Team
  TeamRole:
    type: object
    required:
    - role
    properties:
      role:
        type: string
        enum: [admin, member]
  PasswordUpdate:
    type: object
    required:
    - oldpass
    - newpass
    properties:
      oldpass:
        type: string
        example: password
        format: password
        pattern: '^.{6,}$'
      newpass:
        type: string
        example: password
        format: password
        pattern: '^.{6,}$'
  Error:
    type: object
    required:
    - message
    properties:
      message:
        type: string
        example: Object not found
securityDefinitions:
  BearerCookie:
    type: apiKey
    in: header # Realmente en cookie, pero las cookies estan en header
    name: Cookie # La cookie Bearer-Cookie
host: localhost
basePath: /DevTest
schemes:
 - https
