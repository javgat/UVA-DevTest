<div class="mt-2">
    <div class="alert alert-{{getMensaje().type}}" *ngIf="getMensaje().mostrar" id="message" role="alert">
        {{getMensaje().texto}}</div>
    <button *ngIf="testid!=undefined" class="button btn btn-outline-primary m-3" [routerLink]="['/pt', testid]">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
            class="bi bi-chevron-double-left" viewBox="0 0 16 16">
            <path fill-rule="evenodd"
                d="M8.354 1.646a.5.5 0 0 1 0 .708L2.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z" />
            <path fill-rule="evenodd"
                d="M12.354 1.646a.5.5 0 0 1 0 .708L6.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z" />
        </svg>
        Volver al test
    </button>
    <div class="card">
        <div class="card-body">
            <div class="row">
                <h2 class="col">Pregunta: {{question.title}}</h2>
                <div class="col-sm">
                    <div class="d-grid gap-2 d-flex justify-content-md-end" *ngIf="checkCloneQuestion()">
                        <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal"
                            data-bs-target="#modalCloneQuestion">Clonar</button>

                        <input type="checkbox" class="btn-check" id="btn-check-2" [checked]="isFavorita"
                            (click)="changeFavorita()">
                        <label class="btn btn-outline-success" for="btn-check-2">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 26" width="24px"
                                fill="currentColor">
                                <path d="M0 0h24v24H0z" fill="none" />
                                <path d="M0 0h24v24H0z" fill="none" />
                                <path
                                    d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
                            </svg>
                            <span *ngIf="!isFavorita">Guardar
                                Favorita</span><span *ngIf="isFavorita">Guardada Favorita</span> |
                            {{question.cantidadFavoritos}}</label>
                    </div>
                </div>
            </div>
            <p>Autor: <a [routerLink]="['/profile', question.username]">{{question.username}}</a></p>
            <p><button class="btn btn-primary" type="button" [routerLink]="['/q', question.id, 'teams']">Ver equipos
                    administradores</button></p>
            <p>Etiquetas:
                <span *ngFor="let tag of tags">
                    <span *ngIf="checkPermisosEdicion()">
                        <span class="badge bg-warning text-dark" role="button" id="{{tag.tag}}"
                            data-bs-toggle="dropdown" aria-expanded="false">{{tag.tag}}</span>&nbsp;
                        <ul class="dropdown-menu" attr.aria-labelledby="{{tag.tag}}">
                            <li><a class="dropdown-item" role="button" (click)="deleteTagClick(tag.tag)">Eliminar</a>
                            </li>
                        </ul>
                    </span>

                    <span *ngIf="!checkPermisosEdicion()">
                        <span class="badge bg-warning text-dark">{{tag.tag}}</span>&nbsp;
                    </span>
                </span>
            </p>
            <form *ngIf="checkPermisosEdicion()" (ngSubmit)='addTagSubmit()' ngNativeValidate>
                <div class="input-group my-3">
                    <input class="button btn btn-primary" type="submit" value="Añadir etiqueta" />
                    <input type="text" class="form-control" name="inputAddTag" [(ngModel)]="newTag.tag"
                        placeholder="Etiqueta" required pattern=".+" list="auto_tags" autocomplete="off"
                        (ngModelChange)="changeGetAutoTags()" />
                    <datalist id="auto_tags">
                        <option *ngFor="let autotag of autotags" value="{{autotag.tag}}">
                    </datalist>
                </div>
            </form>
            <hr />
            <div class="d-grid gap-2 my-3">
                <button *ngIf="checkPermisosEdicion()" type="button" class="btn btn-primary btn-lg"
                    data-bs-toggle="modal" data-bs-target="#editQuestionModal">
                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 26" width="24px"
                        fill="currentColor">
                        <path d="M0 0h24v24H0z" fill="none" />
                        <path
                            d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" />
                    </svg>
                    Editar pregunta</button>
            </div>
            <p><b>ID:</b> {{question.id}}</p>
            <p><b>Tiempo estimado:</b> {{question.estimatedTime}} minutos</p>
            <p><b>Corrección automática:</b> <span *ngIf="question.autoCorrect"> Sí</span><span
                    *ngIf="!question.autoCorrect"> No</span></p>
            <p><b>Acceso público para profesores:</b> <span *ngIf="question.accesoPublicoNoPublicada"> Sí</span><span
                    *ngIf="!question.accesoPublicoNoPublicada"> No</span></p>
            <p><b>Penalización por fallo:</b>
                <span *ngIf="question.penalizacion!=0"> {{question.penalizacion}} %</span>
                <span *ngIf="question.penalizacion==0"> No</span>
            </p>
            <p><b>Tipo:</b> {{tipoPrint}}</p>
            <p *ngIf="!question.editable"><button class="btn btn-primary" type="button"
                    [routerLink]="['/pt', testid, 'q', question.id, 'qanswers']">Ver respuestas entregadas</button></p>
            <hr />
            <h5>Enunciado:</h5>
            <div class="card mb-3">
                <div class="card-body">
                    <markdown class="my-3" [data]="question.question"></markdown>
                </div>
            </div>
        </div>
    </div>
    <div class="my-3">
        <h3>Respuesta:</h3>
        <div class="m-3" *ngIf="question.tipoPregunta=='string'">
            <p>Respuesta esperada:</p>
            <p>{{question.solucion}}</p>
            <form class="my-4" (ngSubmit)='putQuestionSubmit()' ngNativeValidate>
                <div *ngIf="checkPermisosEdicion()">
                    <h5>Modificar respuesta esperada:</h5>
                    <div class="input-group my-3">
                        <input type="text" class="form-control" name="inputAddOption"
                            [(ngModel)]="questionEdit.solucion" required pattern=".+" />
                    </div>
                    <input class="button btn btn-primary" type="submit"
                        value="Guardar modificación de respuesta esperada" />
                </div>
            </form>
        </div>
        <div class="m-3" *ngIf="question.tipoPregunta=='opciones'">
            <h4>Opciones:</h4>
            <form (ngSubmit)='addOptionSubmit()' ngNativeValidate>
                <div *ngIf="checkPermisosEdicion()" class="input-group my-3">
                    <input class="button btn btn-primary" type="submit" value="Añadir opción" [disabled]="anadirOpcionDisabled()" />
                    <input type="text" class="form-control" name="inputAddOption" [(ngModel)]="nuevaOpcion.texto"
                        placeholder="Introduce el texto de la nueva opción" required pattern=".+" />
                </div>
            </form>
            <div *ngFor="let opc of opciones">
                <div class="my-4 card">
                    <div class="card-body">
                        <div class="my-1">{{opc.texto}}</div>
                        <span style="color:green" *ngIf="opc.correcta">
                            <!--tick-->
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"
                                fill="currentColor">
                                <path d="M0 0h24v24H0V0z" fill="none" />
                                <path
                                    d="M19.77 5.03l1.4 1.4L8.43 19.17l-5.6-5.6 1.4-1.4 4.2 4.2L19.77 5.03m0-2.83L8.43 13.54l-4.2-4.2L0 13.57 8.43 22 24 6.43 19.77 2.2z" />
                            </svg>
                        </span>
                        <span style="color: red" *ngIf="!opc.correcta">
                            <!--Cross-->
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"
                                fill="currentColor">
                                <path d="M0 0h24v24H0z" fill="none" />
                                <path
                                    d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z" />
                            </svg>
                        </span>
                        <div class="my-1">
                            <div class="row">
                                <div class="col-sm">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" id="radioCorrecta{{opc.indice}}"
                                            role="button" [checked]="opc.correcta" (change)="changeCorrectaOpc(opc)"
                                            [disabled]="!checkPermisosEdicion()">
                                        <label class="form-check-label" role="button"
                                            for="radioCorrecta{{opc.indice}}">Respuesta correcta</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" id="radioIncorrecta{{opc.indice}}"
                                            role="button" [checked]="!opc.correcta" (change)="changeCorrectaOpc(opc)"
                                            [disabled]="!checkPermisosEdicion()">
                                        <label class="form-check-label" role="button"
                                            for="radioIncorrecta{{opc.indice}}">Respuesta incorrecta</label>
                                    </div>
                                </div>
                                <div class="col-sm">
                                    <div class="btn-group dropstart d-grid gap-2 d-md-flex d-inline-flex justify-content-md-end col-sm"
                                        role="button" *ngIf="checkPermisosEdicion()">
                                        <a data-bs-toggle="dropdown" class="link-dark" aria-expanded="false">
                                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24"
                                                width="24px" fill="currentColor">
                                                <path d="M0 0h24v24H0z" fill="none" />
                                                <path
                                                    d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
                                            </svg>
                                        </a>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" (click)="deleteOpc(opc.indice)">Eliminar</a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="m-3" *ngIf="question.tipoPregunta=='codigo'">
            <p>Tests:</p>
        </div>
    </div>
</div>
<!-- Modal edit question-->
<div class="modal fade" id="editQuestionModal" *ngIf="checkPermisosEdicion()" tabindex="-1"
    aria-labelledby="editQuestionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <form ngNativeValidate>
                <div class="modal-header">
                    <h5 class="modal-title" id="editQuestionModalLabel">Modificar Pregunta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="inputTitle" class="form-label">Título de la pregunta</label>
                        <input type="text" class="form-control" name="inputTitle" [(ngModel)]="questionEdit.title"
                            required />
                    </div>
                    <div class="mb-3">
                        <label for="inputQuestion" class="form-label">Cuerpo de la pregunta</label>
                        <textarea type="text" class="form-control" name="inputQuestion"
                            [(ngModel)]="questionEdit.question" required rows=3></textarea>
                        <div id="inputDescriptionHelp" class="form-text text-muted">Puedes utilizar MarkDown</div>
                    </div>
                    <div class="mb-3">
                        <label for="inputTime" class="form-label">Tiempo estimado (minutos)</label>
                        <input type="number" class="form-control" name="inputTime"
                            [(ngModel)]="questionEdit.estimatedTime" required min=0 />
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="flexSwitchCheckDefault"
                            [checked]="questionEdit.autoCorrect"
                            (change)="questionEdit.autoCorrect = !questionEdit.autoCorrect">
                        <label class="form-check-label" for="flexSwitchCheckDefault">Corrección automática</label>
                    </div>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="flexSwitchAccesoPublicoNoPublicada"
                            [checked]="questionEdit.accesoPublicoNoPublicada"
                            (change)="questionEdit.accesoPublicoNoPublicada = !questionEdit.accesoPublicoNoPublicada">
                        <label class="form-check-label" for="flexSwitchAccesoPublicoNoPublicada">Acceso público para
                            profesores</label>
                    </div>
                    <div class="mb-3">
                        <label for="inputPenalizacion" class="form-label">Penalización (%)</label>
                        <input type="number" class="form-control" name="inputPenalizacion"
                            [(ngModel)]="questionEdit.penalizacion" required min=0 max=100 />
                    </div>
                    <div class="my-3">
                        <label class="form-label">Tipo de pregunta:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="inputTipo" id="inputTipoString" required
                                (change)="onSelectTipoString()"
                                [checked]="tipPrint(questionEdit.tipoPregunta, questionEdit.eleccionUnica)=='Texto'" />
                            <label class="form-check-label" for="inputTipoString">
                                Pregunta de texto
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="inputTipo" id="inputTipoRadio" required
                                (change)="onSelectTipoRadio()"
                                [checked]="tipPrint(questionEdit.tipoPregunta, questionEdit.eleccionUnica)=='Respuesta única'" />
                            <label class="form-check-label" for="inputTipoRadio">
                                Pregunta tipo test de respuesta única
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="inputTipo" id="inputTipoCheck" required
                                (change)="onSelectTipoCheck()"
                                [checked]="tipPrint(questionEdit.tipoPregunta, questionEdit.eleccionUnica)=='Respuesta múltiple'" />
                            <label class="form-check-label" for="inputTipoCheck">
                                Pregunta tipo test de respuesta múltiple
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="inputTipo" id="inputTipoCode" required
                                (change)="onSelectTipoCode()"
                                [checked]="tipPrint(questionEdit.tipoPregunta, questionEdit.eleccionUnica)=='Código'" />
                            <label class="form-check-label" for="inputTipoCode">
                                Pregunta de código
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <input type="submit" value="Guardar" (click)='putQuestionSubmit()' data-bs-dismiss="modal"
                        class="btn btn-primary" id="buttonChangeRol" />
                </div>
            </form>
        </div>
    </div>
</div>
<!-- Confirmacion clonar-->
<div class="modal fade" id="modalCloneQuestion" tabindex="-1" aria-labelledby="modalCloneQuestionLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form ngNativeValidate>
                <div class="modal-header">
                    <h5 class="modal-title" id="modalCloneQuestionLabel">¿Clonar pregunta?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Se creará una pregunta nueva
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success" data-bs-dismiss="modal"
                        (click)="cloneQuestionClick()">Clonar</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
</div>